#!/bin/sh

set -e

USAGE='Usage: git cococo <command> [args...]

Example:

    $ git cococo sed -e s/foo/bar/g *.txt
'

if test -z "$1"
then
  echo -n "$USAGE" 1>&2
  exit 1
fi

uncommitted_changes_are_exists() {
  test x != "x$(git status --short)"
}

if uncommitted_changes_are_exists
then
  cat <<EOF
Detects following uncommitted changes:

`git status --short | sed -e 's|^|  |'`

Run "git stash" and retry "git cococo":

  $ git stash --include-untracked &&
    git cococo $* &&
    git stash pop
EOF
  exit 1
fi

$*
if uncommitted_changes_are_exists
then
  git add --all
  git commit --quiet -m "run: git cococo $*"
else
  echo No changes are detected.
fi
